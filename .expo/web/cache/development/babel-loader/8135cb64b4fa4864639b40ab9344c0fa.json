{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nvar _jsxFileName = \"/Users/christopherkoch/reactnatchat/components/CustomActions.js\";\nimport PropTypes from \"prop-types\";\nimport React from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport View from \"react-native-web/dist/exports/View\";\nimport * as Permissions from \"expo-permissions\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Location from 'expo-location';\n\nvar firebase = require(\"firebase\");\n\nrequire(\"firebase/firestore\");\n\nvar CustomActions = function (_React$Component) {\n  _inherits(CustomActions, _React$Component);\n\n  function CustomActions() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CustomActions);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CustomActions)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.imagePicker = function _callee() {\n      var _ref, status, result, imageUrl;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA_ROLL));\n\n            case 2:\n              _ref = _context.sent;\n              status = _ref.status;\n              _context.prev = 4;\n\n              if (!(status === \"granted\")) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n                mediaTypes: ImagePicker.MediaTypeOptions.Images\n              }).catch(function (error) {\n                return console.log(error);\n              }));\n\n            case 8:\n              result = _context.sent;\n\n              if (result.cancelled) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.next = 12;\n              return _regeneratorRuntime.awrap(_this.uploadImageFetch(result.uri));\n\n            case 12:\n              imageUrl = _context.sent;\n\n              _this.props.onSend({\n                image: imageUrl\n              });\n\n            case 14:\n              _context.next = 19;\n              break;\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](4);\n              console.log(_context.t0.message);\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[4, 16]]);\n    };\n\n    _this.takePhoto = function _callee2() {\n      var _ref2, status, result, imageUrl;\n\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA, Permissions.CAMERA_ROLL));\n\n            case 2:\n              _ref2 = _context2.sent;\n              status = _ref2.status;\n              _context2.prev = 4;\n\n              if (!(status === \"granted\")) {\n                _context2.next = 14;\n                break;\n              }\n\n              _context2.next = 8;\n              return _regeneratorRuntime.awrap(ImagePicker.launchCameraAsync({\n                mediaTypes: ImagePicker.MediaTypeOptions.Images\n              }).catch(function (error) {\n                return console.log(error);\n              }));\n\n            case 8:\n              result = _context2.sent;\n\n              if (result.cancelled) {\n                _context2.next = 14;\n                break;\n              }\n\n              _context2.next = 12;\n              return _regeneratorRuntime.awrap(_this.uploadImageFetch(result.uri));\n\n            case 12:\n              imageUrl = _context2.sent;\n\n              _this.props.onSend({\n                image: imageUrl\n              });\n\n            case 14:\n              _context2.next = 19;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](4);\n              console.log(_context2.t0.message);\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, [[4, 16]]);\n    };\n\n    _this.getLocation = function _callee3() {\n      var _ref3, status, result, longitude, altitude;\n\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.LOCATION));\n\n            case 3:\n              _ref3 = _context3.sent;\n              status = _ref3.status;\n\n              if (!(status === \"granted\")) {\n                _context3.next = 12;\n                break;\n              }\n\n              _context3.next = 8;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}).catch(function (error) {\n                return console.log(error);\n              }));\n\n            case 8:\n              result = _context3.sent;\n              longitude = JSON.stringify(result.coords.longitude);\n              altitude = JSON.stringify(result.coords.latitude);\n\n              if (result) {\n                _this.props.onSend({\n                  location: {\n                    longitude: result.coords.longitude,\n                    latitude: result.coords.latitude\n                  }\n                });\n              }\n\n            case 12:\n              _context3.next = 17;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.log(_context3.t0.message);\n\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, [[0, 14]]);\n    };\n\n    _this.uploadImageFetch = function _callee4(uri) {\n      var blob, imageNameBefore, imageName, ref, snapshot;\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(new Promise(function (resolve, reject) {\n                var xhr = new XMLHttpRequest();\n\n                xhr.onload = function () {\n                  resolve(xhr.response);\n                };\n\n                xhr.onerror = function (e) {\n                  console.log(e);\n                  reject(new TypeError(\"Network request failed\"));\n                };\n\n                xhr.responseType = \"blob\";\n                xhr.open(\"GET\", uri, true);\n                xhr.send(null);\n              }));\n\n            case 2:\n              blob = _context4.sent;\n              imageNameBefore = uri.split(\"/\");\n              imageName = imageNameBefore[imageNameBefore.length - 1];\n              ref = firebase.storage().ref().child(\"images/\" + imageName);\n              _context4.next = 8;\n              return _regeneratorRuntime.awrap(ref.put(blob));\n\n            case 8:\n              snapshot = _context4.sent;\n              blob.close();\n              _context4.next = 12;\n              return _regeneratorRuntime.awrap(snapshot.ref.getDownloadURL());\n\n            case 12:\n              return _context4.abrupt(\"return\", _context4.sent);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      });\n    };\n\n    _this.onActionPress = function () {\n      var options = [\"Choose From Library\", \"Take Picture\", \"Send Location\", \"Cancel\"];\n      var cancelButtonIndex = options.length - 1;\n\n      _this.context.actionSheet().showActionSheetWithOptions({\n        options: options,\n        cancelButtonIndex: cancelButtonIndex\n      }, function _callee5(buttonIndex) {\n        return _regeneratorRuntime.async(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.t0 = buttonIndex;\n                _context5.next = _context5.t0 === 0 ? 3 : _context5.t0 === 1 ? 5 : _context5.t0 === 2 ? 7 : 9;\n                break;\n\n              case 3:\n                console.log(\"user wants to pick an image\");\n                return _context5.abrupt(\"return\", _this.imagePicker());\n\n              case 5:\n                console.log(\"user wants to take a photo\");\n                return _context5.abrupt(\"return\", _this.takePhoto());\n\n              case 7:\n                console.log(\"user wants to get their location\");\n                return _context5.abrupt(\"return\", _this.getLocation());\n\n              case 9:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        });\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(CustomActions, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(TouchableOpacity, {\n        accessible: true,\n        accessibilityLabel: \"More options\",\n        accessibilityHint: \"Let\\u2019s you choose to send an image or your geolocation.\",\n        style: [styles.container],\n        onPress: this.onActionPress,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        }\n      }, React.createElement(View, {\n        style: [styles.wrapper, this.props.wrapperStyle],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        }\n      }, React.createElement(Text, {\n        style: [styles.iconText, this.props.iconTextStyle],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        }\n      }, \"+\")));\n    }\n  }]);\n\n  return CustomActions;\n}(React.Component);\n\nexport { CustomActions as default };\nvar styles = StyleSheet.create({\n  container: {\n    width: 26,\n    height: 26,\n    marginLeft: 10,\n    marginBottom: 10\n  },\n  wrapper: {\n    borderRadius: 13,\n    borderColor: \"#b2b2b2\",\n    borderWidth: 2,\n    flex: 1\n  },\n  iconText: {\n    color: \"#b2b2b2\",\n    fontWeight: \"bold\",\n    fontSize: 16,\n    backgroundColor: \"transparent\",\n    textAlign: \"center\"\n  }\n});\nCustomActions.contextTypes = {\n  actionSheet: PropTypes.func\n};","map":{"version":3,"sources":["/Users/christopherkoch/reactnatchat/components/CustomActions.js"],"names":["PropTypes","React","Permissions","ImagePicker","Location","firebase","require","CustomActions","imagePicker","askAsync","CAMERA_ROLL","status","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","Images","catch","error","console","log","result","cancelled","uploadImageFetch","uri","imageUrl","props","onSend","image","message","takePhoto","CAMERA","launchCameraAsync","getLocation","LOCATION","getCurrentPositionAsync","longitude","JSON","stringify","coords","altitude","latitude","location","Promise","resolve","reject","xhr","XMLHttpRequest","onload","response","onerror","e","TypeError","responseType","open","send","blob","imageNameBefore","split","imageName","length","ref","storage","child","put","snapshot","close","getDownloadURL","onActionPress","options","cancelButtonIndex","context","actionSheet","showActionSheetWithOptions","buttonIndex","styles","container","wrapper","wrapperStyle","iconText","iconTextStyle","Component","StyleSheet","create","width","height","marginLeft","marginBottom","borderRadius","borderColor","borderWidth","flex","color","fontWeight","fontSize","backgroundColor","textAlign","contextTypes","func"],"mappings":"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","sourcesContent":["/**\n* @description this file handles the CustomAction button in text input field\n* @class CustomActions\n* @requires React\n* @requires React-Native\n* @requires Prop-Types\n* @requires Expo-Image-Picker\n* @requires Expo-Permissions\n* @requires Expo-Location\n* @requires Firebase\n* @requires Firestore\n*/\n\n//  import PropTypes\nimport PropTypes from \"prop-types\";\n//import react\nimport React from \"react\";\n//import necessary components from react-native\nimport { StyleSheet, Text, TouchableOpacity, View } from \"react-native\";\n//import permissions and imagepicker\nimport * as Permissions from \"expo-permissions\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Location from 'expo-location';\n//import firebase\nconst firebase = require(\"firebase\");\nrequire(\"firebase/firestore\");\n\nexport default class CustomActions extends React.Component {\n  /**\n    * Let the user pick an image from the device's image library\n    * @function imagePicker\n    * @async\n    */\n  imagePicker = async () => {\n    // expo permission\n    const { status } = await Permissions.askAsync(Permissions.CAMERA_ROLL);\n    try {\n      if (status === \"granted\") {\n        // pick image\n        const result = await ImagePicker.launchImageLibraryAsync({\n          mediaTypes: ImagePicker.MediaTypeOptions.Images // only images are allowed\n        }).catch(error => console.log(error));\n        // canceled process\n        if (!result.cancelled) {\n          const imageUrl = await this.uploadImageFetch(result.uri);\n          this.props.onSend({ image: imageUrl });\n        }\n      }\n    } catch (error) {\n      console.log(error.message);\n    }\n  };\n\n  /**\n  * Let the user take a photo with device's camera\n  * @function takePhoto\n  * @async\n  */\n  takePhoto = async () => {\n    const { status } = await Permissions.askAsync(\n      Permissions.CAMERA,\n      Permissions.CAMERA_ROLL\n    );\n    try {\n      if (status === \"granted\") {\n        const result = await ImagePicker.launchCameraAsync({\n          mediaTypes: ImagePicker.MediaTypeOptions.Images\n        }).catch(error => console.log(error));\n\n        if (!result.cancelled) {\n          const imageUrl = await this.uploadImageFetch(result.uri);\n          this.props.onSend({ image: imageUrl });\n        }\n      }\n    } catch (error) {\n      console.log(error.message);\n    }\n  };\n\n  /**\n  * get the location of the user by using GPS\n  * @function getLocation\n  * @async\n  */\n  getLocation = async () => {\n    try {\n      const { status } = await Permissions.askAsync(Permissions.LOCATION);\n      if (status === \"granted\") {\n        const result = await Location.getCurrentPositionAsync({}).catch(error =>\n          console.log(error)\n        );\n        const longitude = JSON.stringify(result.coords.longitude);\n        const altitude = JSON.stringify(result.coords.latitude);\n        if (result) {\n          this.props.onSend({\n            location: {\n              longitude: result.coords.longitude,\n              latitude: result.coords.latitude\n            },\n          });\n        }\n      }\n    } catch (error) {\n      console.log(error.message);\n    }\n  };\n\n  /**\n  * Upload images to firebase\n  * @function uploadImageFetch\n  * @async\n  */\n  uploadImageFetch = async uri => {\n    const blob = await new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.onload = function () {\n        resolve(xhr.response);\n      };\n      xhr.onerror = function (e) {\n        console.log(e);\n        reject(new TypeError(\"Network request failed\"));\n      };\n      xhr.responseType = \"blob\";\n      xhr.open(\"GET\", uri, true);\n      xhr.send(null);\n    });\n\n    const imageNameBefore = uri.split(\"/\");\n    const imageName = imageNameBefore[imageNameBefore.length - 1];\n\n    const ref = firebase\n      .storage()\n      .ref()\n      .child(`images/${imageName}`);\n\n    const snapshot = await ref.put(blob);\n\n    blob.close();\n\n    return await snapshot.ref.getDownloadURL();\n  };\n\n  /**\n * function that handles communication features\n * @function onActionPress\n */\n  onActionPress = () => {\n    const options = [\n      \"Choose From Library\",\n      \"Take Picture\",\n      \"Send Location\",\n      \"Cancel\"\n    ];\n    const cancelButtonIndex = options.length - 1;\n    this.context.actionSheet().showActionSheetWithOptions(\n      {\n        options,\n        cancelButtonIndex\n      },\n      async buttonIndex => {\n        switch (buttonIndex) {\n          case 0:\n            console.log(\"user wants to pick an image\");\n            return this.imagePicker();\n          case 1:\n            console.log(\"user wants to take a photo\");\n            return this.takePhoto();\n          case 2:\n            console.log(\"user wants to get their location\");\n            return this.getLocation();\n        }\n      }\n    );\n  };\n\n  //render function\n  render() {\n    return (\n      <TouchableOpacity\n        accessible={true}\n        accessibilityLabel=\"More options\"\n        accessibilityHint=\"Let’s you choose to send an image or your geolocation.\"\n        style={[styles.container]}\n        onPress={this.onActionPress}\n      >\n        <View style={[styles.wrapper, this.props.wrapperStyle]}>\n          <Text style={[styles.iconText, this.props.iconTextStyle]}>+</Text>\n        </View>\n      </TouchableOpacity>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    width: 26,\n    height: 26,\n    marginLeft: 10,\n    marginBottom: 10\n  },\n  wrapper: {\n    borderRadius: 13,\n    borderColor: \"#b2b2b2\",\n    borderWidth: 2,\n    flex: 1\n  },\n  iconText: {\n    color: \"#b2b2b2\",\n    fontWeight: \"bold\",\n    fontSize: 16,\n    backgroundColor: \"transparent\",\n    textAlign: \"center\"\n  }\n});\n\nCustomActions.contextTypes = {\n  actionSheet: PropTypes.func\n};"]},"metadata":{},"sourceType":"module"}